#include <stdio.h>
#include <stdlib.h>
#include <omp.h>

void m(int a[],int l,int mid,int r){
  int n1=mid-l+1,n2=r-mid,i=0,j=0,k=l;
  int *L=malloc(n1*sizeof(int)),*R=malloc(n2*sizeof(int));
  for(i=0;i<n1;i++)L[i]=a[l+i];
  for(j=0;j<n2;j++)R[j]=a[mid+1+j];
  i=j=0;
  while(i<n1&&j<n2)a[k++]=(L[i]<=R[j])?L[i++]:R[j++];
  while(i<n1)a[k++]=L[i++]; while(j<n2)a[k++]=R[j++];
  free(L); free(R);
}

void ssort(int a[],int l,int r){
  if(l<r){int mid=(l+r)/2; ssort(a,l,mid); ssort(a,mid+1,r); m(a,l,mid,r);}
}

void psort(int a[],int l,int r,int d){
  if(l<r){
    int mid=(l+r)/2;
    if(d>0){
      #pragma omp parallel sections
      {
        #pragma omp section 
        psort(a,l,mid,d-1);
        #pragma omp section 
        psort(a,mid+1,r,d-1);
      }
    } else { ssort(a,l,mid); ssort(a,mid+1,r); }
    m(a,l,mid,r);
  }
}

int main(int c,char **v){
  int n = c>1?atoi(v[1]):10000;
  int *a=malloc(n*sizeof(int)), *b=malloc(n*sizeof(int));
  for(int i=0;i<n;i++){ a[i]=rand()%100000; b[i]=a[i]; }
  double t1=omp_get_wtime(); ssort(b,0,n-1); t1=omp_get_wtime()-t1;
  double t2=omp_get_wtime(); psort(a,0,n-1,3); t2=omp_get_wtime()-t2;
  printf("seq: %.6f  par: %.6f\n", t1, t2);
  free(a); free(b);
  return 0;
}
